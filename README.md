# 二维结构动力学仿真与损伤识别学习项目

## 1. 项目简介
本项目主要是我在学习结构有限元方法和数据驱动损伤识别过程中的一些编程实践。项目目前包含两个主要部分：
*   **第一部分：有限元计算基础** —— 编写了基本的二维有限元内核，能够进行结构的静力输出和基于 Newmark-beta 方法的动力响应计算。
*   **第二部分：深度学习识别练习** —— 尝试利用仿真得到的数据，学习使用图神经网络（Graph Transformer）对结构单元的损伤情况进行初步识别。

---

## 2. 第一部分：有限元程序实现流程

这部分按照有限元分析的标准步骤进行开发和组织，主要代码均给出了相对路径说明。

### 2.1 建模与参数输入
程序通过 YAML 格式读取结构的节点坐标、单元连接关系以及材料参数。
*   **相关文件**: 
    - `./structure.yaml`: 结构几何与材料定义。
    - `./PyFEM_Dynamics/core/io_parser.py`: 负责解析配置并构建程序中的节点和单元对象。

### 2.2 单元刚度与质量矩阵计算
根据有限元理论，对于二维拉压桁架单元，我们将单根杆件在局部坐标系下的刚度矩阵 $\mathbf{k}^e$ 和质量矩阵 $\mathbf{m}^e$ 表达如下：
$$ \mathbf{k}^e = \frac{EA}{L}\begin{bmatrix} 1 & -1 \\ -1 & 1 \end{bmatrix}, \quad \mathbf{m}^e = \frac{\rho A L}{6}\begin{bmatrix} 2 & 1 \\ 1 & 2 \end{bmatrix} $$
*   **关键代码**: `./PyFEM_Dynamics/core/element.py` 中的 `get_local_stiffness` 和 `get_local_mass` 函数。

### 2.3 全局矩阵组装
通过直接刚度法，将分散的单元矩阵累加到总刚度矩阵 $\mathbf{K}$ 和总质量矩阵 $\mathbf{M}$ 中。
*   **关键代码**: `./PyFEM_Dynamics/solver/assembler.py`。在这里我使用了稀疏矩阵存储方式，以节省计算内存。

### 2.4 边界条件的数值处理
为了处理支座约束，程序采用了**划零划一法**。即对于受约束的自由度，将其对应的行和列清零，并将对角线元素设为 1。
*   **关键代码**: `./PyFEM_Dynamics/solver/boundary.py`。

### 2.5 动力学时间积分求解
动力学方程的求解使用了 **Newmark-$\beta$ 法**。该方法通过迭代步进的方式求解每一时刻的位移、速度和加速度。
$$ \mathbf{M}\ddot{\mathbf{u}}_{t+1} + \mathbf{C}\dot{\mathbf{u}}_{t+1} + \mathbf{K}\mathbf{u}_{t+1} = \mathbf{F}_{t+1} $$
其中阻尼矩阵 $\mathbf{C}$ 使用了 Rayleigh 比例阻尼模型。
*   **关键代码**: `./PyFEM_Dynamics/solver/integrator.py`。

---

## 3. 第二部分：深度学习识别尝试

在掌握了有限元数据生成后，我尝试将这些数据用于训练深度学习模型，以探究其在损伤识别上的效果。

### 3.1 训练数据准备
通过有限元程序，我运行了 **10,000** 次随机工况（包含不同的单元刚度折减和载荷），生成了包含加速度响应及其对应损伤状态的数据集。
*   **数据生成代码**: `./PyFEM_Dynamics/pipeline/data_gen.py`。

### 3.2 深度学习模型描述
为了更好地利用结构的拓扑关系，我参考了一些研究，选取了 **Graph Transformer** 模型。
- **基本思路**: 将结构节点看作图的顶点，将杆件看作边。模型通过注意力机制（Attention）来学习不同位置传感器信号之间的联系。
- **输出内容**: 模型尝试预测每个单元对应的残余刚度系数（1.0 代表完好）。
*   **模型结构代码**: `./deep_learning/models/gt_model.py`。

### 3.3 训练效果初探
通过 100 轮（Epochs）的训练，模型在测试集上的表现如下：

| 评估指标 | 指标数值 | 初步分析 |
| :--- | :--- | :--- |
| **平均绝对误差 (MAE)** | **0.076** | 预测值与真实损伤程度的平均偏差相对较小。 |
| **F1-Score** | **0.384** | 能够定位到一部分损伤严重的单元，但仍有改进空间。 |

![学习曲线](docs/images/dl_results/gt_history.png)
*   **说明**: 训练历史显示模型在较短时间内完成了基础的特征学习。

---

## 4. 第三部分：后续工况预测 (拟开展内容)

这部分内容计划在后续研究中补充。

*   **拟开展工作 1**: 验证模型在不同载荷频率下的泛化表现。
*   **拟开展工作 2**: 尝试将模型用于识别未在训练集中出现的复杂损伤模式。

---

## 5. 小结
通过这个项目，我复习了有限元分析的基本计算流程，并初步了解了如何将深度学习方法应用到工程问题中。虽然目前的识别精度和模型通用性还有待加强，但整个流程的打通为我接下来的研究提供了一个基础平台。
